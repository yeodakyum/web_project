<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>한양네컷</title>
    <link href="style.css" rel="stylesheet" />
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  </head>
  <body>
    <header>
      <h1>한양네컷</h1>
    </header>
    <nav id="navbar">
      <ul>
        <!-- <li><a href="#" data-content="about">ABOUT US</a></li>
        <li><a href="#" data-content="upload">UPLOAD</a></li>
        <li>
          <a href="#" data-content="filter" data-next-content="filter"
            >FILTER</a
          >
        </li> -->
        <li data-content="about">ABOUT US</li>
        <li data-content="upload">UPLOAD</li>
        <li data-content="filter">FILTER</li>
      </ul>
    </nav>
    <main>
      <div id="about" class="content">
        <h1>당신의 일상을 예술작품으로 바꿔보세요.</h1>
        <br />
        <p>
          단 몇 번의 클릭으로 사진 업로드부터 프레임 색깔, 그리고 필터 적용까지
          모든 과정이 가능합니다.
        </p>
        <p>
          다양한 프레임 색깔은 여러분의 사진을 독특하게 만들어주며, 수많은
          필터는 감정과 분위기를 살려줍니다.
        </p>
        <p>
          이 모든 것은 여러분의 사진을 그저 사진이 아닌, 여러분의 이야기와
          감정을 담은 예술작품으로 만들어 드립니다.
        </p>
        <p>완성된 작품은 다운로드 받아 언제든지 감상하실 수 있습니다.</p>
        <br />
        <button class="page-button" data-next-content="upload">
          사진 업로드하기
        </button>
      </div>

      <div id="upload" class="content" style="display: none">
        <div class="flex-container">
          <div class="button-container">
            <button class="frame-button" onclick="open_color()">
              프레임 변경하기
            </button>
          </div>
          <div class="image-container">
            <input type="color" id="color" onchange="color_change()" hidden />
            <div id="capture">
            <div id="img_list">
              <div class="img_group">
                <input
                  id="input1"
                  type="file"
                  onchange="change(this.id)"
                  accept="image/*"
                  hidden
                />
                <label for="input1"><img class="img" src="plus.png" /></label>
              </div>
              <div class="img_group">
                <input
                  id="input2"
                  type="file"
                  onchange="change(this.id)"
                  accept="image/*"
                  hidden
                />
                <label for="input2"><img class="img" src="plus.png" /></label>
              </div>
              <div class="img_group">
                <input
                  id="input3"
                  type="file"
                  onchange="change(this.id)"
                  accept="image/*"
                  hidden
                />
                <label for="input3"><img class="img" src="plus.png" /></label>
              </div>
              <div class="img_group">
                <input
                  id="input4"
                  type="file"
                  onchange="change(this.id)"
                  accept="image/*"
                  hidden
                />
                <label for="input4"><img class="img" src="plus.png" /></label>
              </div>
            </div>
            </div>
          </div>
          <div class="button-container">
            <button class="page-button" data-next-content="filter">
              필터 적용하기
            </button>
            <p>반드시 4개의 사진을 모두<br />업로드하고 이동해주세요!</p>
          </div>
        </div>
      </div>

      <div id="filter" class="content" style="display: none">
        <div class="flex-container">
          <div class="button-container">
            <button class="filter-button" data-filter="brightness">
              Brightness
            </button>
            <button class="filter-button" data-filter="contrast">
              Contrast
            </button>
            <button class="filter-button" data-filter="saturate">
              Saturate
            </button>
            <button class="filter-button" data-filter="sepia">Sepia</button>
            <button class="filter-button" data-filter="grayscale">
              Grayscale
            </button>
            <button class="filter-button" data-filter="blur">Blur</button>
            <button class="filter-button" id="clear-filters">필터 해제</button>
          </div>
          <div class="image-container" id="filter-image-container" style="display: block;">
            <!-- 업로드된 사진들이 여기에 추가됩니다 -->
          </div>
          <div class="button-container">
            <button id="download" onclick="donwload_img()">다운로드</button>
          </div>
        </div>
      </div>
    </main>
    <footer>
      한양대학교 정보시스템학과<br />
      권기태, 여다겸, 슈브로
    </footer>
  </body>

  <script>
    // document
    //   .getElementById("navbar")
    //   .addEventListener("click", function (event) {
    //     if (event.target.getAttribute("data-content")) {
    //       event.preventDefault();

    //       let contents = document.getElementsByClassName("content");
    //       for (let i = 0; i < contents.length; i++) {
    //         contents[i].style.display = "none";
    //       }

    //       let contentId = event.target.getAttribute("data-content");
    //       document.getElementById(contentId).style.display = "block";
    //     }
    //   });

    // document.querySelector("main").addEventListener("click", function (event) {
    //   if (event.target.getAttribute("data-next-content")) {
    //     let contents = document.getElementsByClassName("content");
    //     for (let i = 0; i < contents.length; i++) {
    //       contents[i].style.display = "none";
    //     }

    //     let contentId = event.target.getAttribute("data-next-content");
    //     document.getElementById(contentId).style.display = "block";
    //   }
    // });

    function change(id) {
      let input = document.getElementById(id);
      let img = document
        .getElementById(id)
        .parentElement.getElementsByClassName("img")[0];
      if (input.files[0]) img.src = URL.createObjectURL(input.files[0]);
      
      input.parentElement.style.overflow = "auto";
      input.nextElementSibling.style.alignItems = "flex-start";
    }

    function color_change() {
      let color_input = document.getElementById("color").value;
      document.getElementById("img_list").style.backgroundColor = color_input;
    }

    function copyImagesToFilterPage() {
      let imageContainer = document.getElementById("filter-image-container");
      let images = document
        .getElementById("img_list")
        .getElementsByClassName("img");

      // 기존에 추가된 이미지들을 모두 제거합니다
      while (imageContainer.firstChild) {
        imageContainer.firstChild.remove();
      }

      // img_list 전체를 복사하여 필터 페이지에 추가합니다
      let imgList = document.getElementById("img_list");
      let clonedImgList = imgList.cloneNode(true);

      // 이미지를 클릭했을 때 아무런 동작도 하지 않도록 합니다.
      let clonedImages = clonedImgList.getElementsByClassName("img");
      for (let i = 0; i < clonedImages.length; i++) {
        clonedImages[i].addEventListener("click", function (event) {
          event.stopPropagation();
        });
      }

      // 필터 페이지에 이미지 리스트가 이미 존재한다면 제거합니다
      let existingImgList = imageContainer.querySelector("#img_list");
      if (existingImgList) {
        existingImgList.remove();
      }

      // 필터 페이지에 복사한 이미지 리스트를 추가합니다
      imageContainer.appendChild(clonedImgList);
    }

    // // '필터 적용하기' 버튼 클릭 이벤트
    // document
    //   .querySelector('.page-button[data-next-content="filter"]')
    //   .addEventListener("click", copyImagesToFilterPage);

    // // nav에서 'FILTER'를 클릭하는 이벤트
    // document
    //   .querySelector('#navbar a[data-content="filter"]')
    //   .addEventListener("click", copyImagesToFilterPage);

    // function change(id) {
    //   let input = document.getElementById(id);
    //   let img = document
    //     .getElementById(id)
    //     .parentElement.getElementsByClassName("img")[0];
    //   if (input.files[0]) img.src = URL.createObjectURL(input.files[0]);
    // }

    // function color_change() {
    //   let color_input = document.getElementById("color").value;
    //   document.getElementById("img_list").style.backgroundColor = color_input;
    // }

    // document
    //   .querySelector('.page-button[data-next-content="filter"]')
    //   .addEventListener("click", function () {
    //     let imageContainer = document.getElementById("filter-image-container");
    //     let images = document
    //       .getElementById("img_list")
    //       .getElementsByClassName("img");

    //     // 기존에 추가된 이미지들을 모두 제거합니다
    //     while (imageContainer.firstChild) {
    //       imageContainer.firstChild.remove();
    //     }

    //     // 업로드된 이미지들을 필터 적용 페이지에 추가합니다
    //     for (let i = 0; i < images.length; i++) {
    //       if (images[i].src != "plus.png") {
    //         let img = document.createElement("img");
    //         img.src = images[i].src;
    //         imageContainer.appendChild(img);
    //       }
    //     }
    //   });

    // 필터 버튼 클릭 시 해당 필터를 이미지에 적용합니다
    let buttons = document.querySelectorAll(".filter-button");
    buttons.forEach((button) => {
      button.addEventListener("click", function () {
        let filter = this.getAttribute("data-filter");
        let images = document
          .getElementById("filter-image-container")
          .getElementsByTagName("img");

        for (let i = 0; i < images.length; i++) {
          switch (filter) {
            case "brightness":
              images[i].style.filter = "brightness(1.5)";
              break;
            case "contrast":
              images[i].style.filter = "contrast(1.5)";
              break;
            case "saturate":
              images[i].style.filter = "saturate(2)";
              break;
            case "sepia":
              images[i].style.filter = "sepia(1)";
              break;
            case "grayscale":
              images[i].style.filter = "grayscale(1)";
              break;
            case "blur":
              images[i].style.filter = "blur(3px)";
              break;
          }
        }
      });
    });

    document
      .getElementById("clear-filters")
      .addEventListener("click", function () {
        let images = document
          .getElementById("filter-image-container")
          .getElementsByTagName("img");
        for (let i = 0; i < images.length; i++) {
          images[i].style.filter = "";
        }
      });

    function open_color() {
      let color_input = document.getElementById("color");
      //color_input.hidden=false;
      color_input.click();
    }

    function handleNavigationToUpload(event) {
      let contents = document.getElementsByClassName("content");
      for (let i = 0; i < contents.length; i++) {
        contents[i].style.display = "none";
      }

      let contentId = event.target.getAttribute("data-next-content");
      document.getElementById(contentId).style.display = "block";

      event.stopPropagation(); // Prevent the event from propagating further
    }

    document
      .querySelector('.page-button[data-next-content="upload"]')
      .addEventListener("click", handleNavigationToUpload);

    function handleNavigationToFilter(event) {
      let images = document
        .getElementById("img_list")
        .getElementsByClassName("img");
      let allImagesUploaded = Array.from(images).every(
        (img) => img.src !== "plus.png"
      );

      if (!allImagesUploaded) {
        alert("사진을 모두 업로드해주세요.");
        event.preventDefault(); // 클릭 이벤트가 추가로 진행되는 것을 방지합니다.
        return; // 함수를 종료하여 다음 코드가 실행되지 않게 합니다.
      } else {
        let contents = document.getElementsByClassName("content");
        for (let i = 0; i < contents.length; i++) {
          contents[i].style.display = "none";
        }

        let contentId = event.target.getAttribute("data-next-content");
        document.getElementById(contentId).style.display = "block";

        copyImagesToFilterPage();
      }

      event.stopPropagation(); // Prevent the event from propagating further
    }

    document
      .querySelector('.page-button[data-next-content="filter"]')
      .addEventListener("click", handleNavigationToFilter);

    document
      .querySelector('#navbar a[data-content="filter"]')
      .addEventListener("click", handleNavigationToFilter);

    function navigateTo(pageName) {
      let contents = document.getElementsByClassName("content");
      for (let i = 0; i < contents.length; i++) {
        contents[i].style.display = "none";
      }

      if (pageName === "filter") {
        copyImagesToFilterPage();
      }

      document.getElementById(pageName).style.display = "block";
    }

function saveAs(uri, filename) {

    var link = document.createElement('a');

    if (typeof link.download === 'string') {

        link.href = uri;
        link.download = filename;

        //Firefox requires the link to be in the body
        document.body.appendChild(link);

        //simulate click
        link.click();

        //remove the link when done
        document.body.removeChild(link);

    } else {

        window.open(uri);

    }
}


function saveAs(uri, filename) {

var link = document.createElement('a');

if (typeof link.download === 'string') {

    link.href = uri;
    link.download = filename;

    //Firefox requires the link to be in the body
    document.body.appendChild(link);

    //simulate click
    link.click();

    //remove the link when done
    document.body.removeChild(link);

} else {

    window.open(uri);

}
}
    function donwload_img(){
      console.log("hi");  
        
        html2canvas(document.querySelector('#filter-image-container'),{useCORS: true,allowTaint: true, }).then(function(canvas) {
        console.log(canvas.toDataURL());  
        saveAs(canvas.toDataURL(), 'file-name.png');
        });
      };

      

  </script>

  
</html>
